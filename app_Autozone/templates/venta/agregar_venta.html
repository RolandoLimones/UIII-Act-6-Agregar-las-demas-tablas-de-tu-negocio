{% extends 'base.html' %}
{% block title %}Agregar Venta{% endblock %}
{% block content %}
<div class="card p-4">
  <h4>Agregar Venta</h4>
  <form method="post" id="ventaForm">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label">Fecha de venta</label>
      <input class="form-control" name="fecha_venta" type="date" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Producto</label>
      <select class="form-control" name="producto" id="productoSelect" required>
        <option value="">Seleccionar producto</option>
        {% for producto in productos %}
        <option value="{{ producto.id }}" data-precio="{{ producto.precio }}">
          {{ producto.nombre_producto }} - ${{ producto.precio }}
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Cantidad</label>
      <input class="form-control" name="cantidad" id="cantidadInput" type="number" min="1" value="1" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Total</label>
      <input class="form-control" name="total" id="totalInput" type="number" step="0.01" readonly style="background-color: #f8f9fa;">
      <div class="form-text">El total se calcula automáticamente: Precio del producto × Cantidad</div>
    </div>
    <div class="mb-3">
      <label class="form-label">Cliente</label>
      <select class="form-control" name="cliente" required>
        <option value="">Seleccionar cliente</option>
        {% for cliente in clientes %}
        <option value="{{ cliente.id }}">{{ cliente.nombre_cliente }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Sucursal</label>
      <select class="form-control" name="sucursal" required>
        <option value="">Seleccionar sucursal</option>
        {% for sucursal in sucursales %}
        <option value="{{ sucursal.id }}">{{ sucursal.nombre }} - {{ sucursal.ciudad }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Empleado</label>
      <select class="form-control" name="empleado" required>
        <option value="">Seleccionar empleado</option>
        {% for empleado in empleados %}
        <option value="{{ empleado.id }}">{{ empleado.nombre_empleado }} - {{ empleado.sucursal.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <button class="btn btn-primary">Guardar</button>
    <a href="{% url 'ver_ventas' %}" class="btn btn-secondary">Cancelar</a>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const productoSelect = document.getElementById('productoSelect');
  const cantidadInput = document.getElementById('cantidadInput');
  const totalInput = document.getElementById('totalInput');

  function calcularTotal() {
    const productoOption = productoSelect.options[productoSelect.selectedIndex];
    const precio = parseFloat(productoOption.getAttribute('data-precio')) || 0;
    const cantidad = parseInt(cantidadInput.value) || 0;
    const total = precio * cantidad;
    
    totalInput.value = total.toFixed(2);
  }

  productoSelect.addEventListener('change', calcularTotal);
  cantidadInput.addEventListener('input', calcularTotal);

  // Calcular total inicial
  calcularTotal();
});
</script>
{% endblock %}